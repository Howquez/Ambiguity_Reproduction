---
title: 'Online Appendix D'
subtitle: 'Ambiguity attitudes and surprises'
author:
- name: Aljoscha Minnich
  email: aljoscha.minnich@uni-hamburg.de
  orcid: 0000-0001-5224-0143
  corresponding: false
  affiliations:
    - name: Center for Earth System Research and Sustainability (CEN), University of Hamburg
      address: Bundesstrasse 53
      city: Hamburg
      country: Germany
      postal-code: 20146
    - name: Department of Economics, University of Hamburg
      address:  Von-Melle-Park 5
      city: Hamburg
      country: Germany
      postal-code: 20146
- name: Hauke Roggenkamp
  email: Hauke.Roggenkamp@unisg.ch
  orcid: 0009-0005-5176-4718
  corresponding: false
  affiliations:
    - name: Institute of Behavioral Science and Technology, University of St. Gallen
      address: Torstrasse 25
      city: St. Gallen
      country: Switzerland
      postal-code: 9000
    - name: Faculty of Economics & Social Sciences, Helmut-Schmidt-University
      address: Holstenhofweg 85
      city: Hamburg
      country: Germany
      postal_code: 22043
- name: Andreas Lange
  email: andreas.lange@uni-hamburg.de
  corresponding: true
  affiliations:
    - name: Center for Earth System Research and Sustainability (CEN), University of Hamburg
      address: Bundesstrasse 53
      city: Hamburg
      country: Germany
      postal-code: 20146
    - name: Department of Economics, University of Hamburg
      address:  Von-Melle-Park 5
      city: Hamburg
      country: Germany
      postal-code: 20146
date: now
date-format: long
format: 
  html:
    embed-resources: true
    theme: cosmo
    fig-height: 8
toc: true
bibliography: ../biblio.bib
---

------------------------------------------------------------------------

This document explains how to reproduce the analyses presented in Online Appendix D.

```{r install_packages}
#| output: false

if (!requireNamespace("groundhog", quietly = TRUE)) {
    install.packages("groundhog")
    library("groundhog")
}

pkgs <- c("magrittr", "data.table", "stringr", "lubridate", "knitr", "glue",
          "sandwich", "lmtest",
          "ggplot2", "ggpubr", "rstatix", "patchwork","sjPlot", "stargazer")

groundhog::groundhog.library(pkg = pkgs,
                             date = "2023-09-25")
```

# Read Data

```{r read_data}
# data <- data.table::fread(file = "../data/processed/full.csv")
data <- readRDS(file="../data/processed/full.Rda")
```

```{r factorize}
data[, communication := as.factor(communication)]
data[, communication := factor(communication, levels = c("point","both", "interval"))]
data[, stage := as.factor(stage)]
data[, stage := factor(stage, levels = c("1", "2"))]
```

# Subsets for the four different robustness checks

```{r subset}
subset1<-subset(data,data$comprehension=="rather yes"|data$comprehension=="yes")
subset2<-subset(data,data$wrong_answer_1==0&data$wrong_answer_2==0)

#calculate the 10th and 90th quantile of completion time
data$lowquantile<-quantile(data$completion_time,probs=c(0.1))
data$highquantile<-quantile(data$completion_time,probs=c(0.9))
subset3<-subset(data,data$completion_time>data$lowquantile&data$completion_time<data$highquantile)
subset4<-subset(data,data$mc>=data$ms)
subset4<-subset(subset4,duplicated(subset4$participant.label)|duplicated(subset4$participant.label,fromLast = TRUE))

```


#Table OD.1, OD.2

# Regressions

```{r covariates}
demographics <- c("age_35_52","age_53_plus","female", "high_education", "high_income", "married", "parentship")

all <- c(demographics, "high_temperature","high_usage","high_general_risk","high_weather_risk","high_accuracy","high_credibility")
```

```{r wrapper_function}
event_regressions <- function(event = "b",data2=subset1){
  ols_1 <- lm(formula = reformulate(c("surprise", "treated", "surprise*treated"), response = event),
              data = data2)
  se_1  <- coeftest(x = ols_1, 
                    vcov = vcovCL(ols_1,
                                  cluster = ~data2$participant.label,
                                  type = "HC1"))
  
  ols_2 <- lm(formula = reformulate(c("communication", "treated", "communication*treated"), response = event), 
              data = data2,
              subset = (surprise == FALSE))
  se_2  <- coeftest(x = ols_2, 
                    vcov = vcovCL(ols_2,
                                  cluster = data2[surprise == FALSE, participant.label],
                                  type = "HC1"))
  
  ols_3 <- lm(formula = reformulate(c("communication", "treated", "communication*treated"), response = event), 
              data = data2,
              subset = (surprise == TRUE))
  se_3  <- coeftest(x = ols_3, 
                    vcov = vcovCL(ols_3,
                                  cluster = data2[surprise == TRUE, participant.label],
                                  type = "HC1"))
  
  ols_4 <- lm(formula = reformulate(c("surprise", "treated", "surprise*treated"), response = event), 
              data = data2,
              subset = (communication == "point"))
  se_4  <- coeftest(x = ols_4, 
                    vcov = vcovCL(ols_4,
                                  cluster = data2[communication == "point", participant.label],
                                  type = "HC1"))
  
  ols_5 <- lm(formula = reformulate(c("surprise", "treated", "surprise*treated"), response = event), 
              data = data2,
              subset = (communication == "interval"))
  se_5  <- coeftest(x = ols_5, 
                    vcov = vcovCL(ols_5,
                                  cluster = data2[communication == "interval", participant.label],
                                  type = "HC1"))
  
  ols_6 <- lm(formula = reformulate(c("surprise", "treated", "surprise*treated"), response = event), 
              data = data2,
              subset = (communication == "both"))
  se_6  <- coeftest(x = ols_6, 
                    vcov = vcovCL(ols_6,
                                  cluster = data2[communication == "both", participant.label],
                                  type = "HC1"))
  
  
  
  se <- list(se_1[,2], se_2[,2], se_3[,2], se_4[,2], se_5[,2], se_6[,2])
  p  <- list(se_1[,4], se_2[,4], se_3[,4], se_4[,4], se_5[,4], se_6[,4])
  
  stargazer(ols_1, ols_2, ols_3, ols_4, ols_5, ols_6, 
            align = TRUE, 
            se = se, 
            p = p,   
            title = paste0("Linear regressions: Treatment effects on ", event),
            font.size = "scriptsize",
            type = "html", 
            df = FALSE)
}
```

## b

```{r b}
#| results: asis
event_regressions(event = "b",data2=subset1)
```

## a

```{r a}
#| results: asis
event_regressions(event = "a",data2=subset1)
```


# Figure OD.1

@fig-od1 also presents three panels. These panels visualize confidence intervals of our estimator of interest: the interaction of `stage` and `surprise` (top panel) as well as the interaction between `stage` and `communication` in the lower two panels.

The corresponding data stems from many OLS regressions and are computed in for-loops. Even though the code differs slightly, it is very repetitive between the three panels, which is why we only explain the top panel

## Top Panel

Before calculating the data based on OLS regressions, we specify three different models: `none` represents only treatment variables, `demographics` extends the former by adding demographic variables, and `all` extends the former two by also adding all remaining covariates.

```{r covariates_top}
none <- c("surprise", "treated", "surprise*treated")

demographics <- c(none, "age_35_52","age_53_plus","female", "high_education", "high_income", "married", "parentship")

all <- c(demographics, "high_temperature","high_usage","high_general_risk","high_weather_risk","high_accuracy","high_credibility")
```

Next, we run a nested loop that iterates through all three models and within these models through both ambiguity indices `a` and `b`. From these ols regressions, we compute clustered standard errors using the `{{sandwich}}` and `{{lmtest}}` package. The resulting data is stored in a temporary data.table that is appended to an initially empty data.table called `ci_top`.

```{r data_top}
ci_top <- data.table()
for(RHS in c("none", "demographics", "all")){
  for(LHS in c("a", "b")){
    ols <- lm(formula = reformulate(termlabels = get(RHS), 
                                    response = LHS),
              data = subset1)
    
    tmp <- coefci(x = ols,
                  parm = "surpriseTRUE:treatedTRUE",
                  vcov = vcovCL(x = ols, 
                                cluster = subset1$participant.label, 
                                type = "HC1"),
                  level = 0.95) %>% 
      data.table(model = RHS, outcome = LHS)
    tmp[, center := (`2.5 %` + `97.5 %`)/2]
    
    ci_top <- rbind(ci_top, tmp)
  }
}
```

The result looks as follows. The data.table provides a column for the 2.5% and 97.5% confidence interval, the center of the two, as well as the ols specification as presented in `model` and `outcome`.

```{r}
ci_top %>% head(n = 7) %>% kable()
```

Finally, we plot this data set (`ci_top`) using the `{{ggplot2}}` package. The resulting object is stored as `top` and will be assembled together with the other two panels.

```{r viz_top}
top <- ggplot(data = ci_top,
       mapping = aes(y = outcome)) +
  geom_pointrange(mapping = aes(x = center,
                                y = outcome,
                                xmin = `2.5 %`,
                                xmax = `97.5 %`,
                                shape = factor(model)),
                  data = ci_top,
                  position = position_dodge(width = 0.4),
                  fatten=5,
                  alpha=.8) +
  geom_vline(xintercept = 0, 
             color = "red", 
             alpha = 0.66, 
             show.legend = FALSE) +
  theme_bw() +
  labs(#title = "(a) Effect of contradiction (relative to confirmation)",
       y = "Ambiguity Index", 
       x = "Estimate",
       shape="Control variables")
```

## Left Panel

```{r covariates_left}
none <- c("communication", "treated", "communication*treated")

demographics <- c(none, "age_35_52","age_53_plus","female", "high_education", "high_income", "married", "parentship")

all <- c(demographics, "high_temperature","high_usage","high_general_risk","high_weather_risk","high_accuracy","high_credibility")
```

```{r data_left}
ci_left <- data.table()
for(RHS in c("none", "demographics", "all")){
  for(LHS in c("a", "b")){
    ols <- lm(formula = reformulate(termlabels = get(RHS), 
                                    response = LHS),
              data = subset1,
              subset = (surprise == FALSE))
    for(communication in c("interval", "both")){
      tmp <- coefci(x = ols,
                    parm = paste0("communication", communication, ":treatedTRUE"),
                    vcov = vcovCL(x = ols, 
                                  cluster = subset1[surprise == FALSE,
                                                 participant.label], 
                                  type = "HC1"),
                    level = 0.95) %>% 
        data.table(model = RHS, outcome = paste0(LHS, " (", communication, ")"))
      tmp[, center := (`2.5 %` + `97.5 %`)/2]
      
      ci_left <- rbind(ci_left, tmp)
    }
  }
}
```

```{r}
ci_left %>% head(n = 7) %>% kable()
```

```{r viz_left}
left <- ggplot(data = ci_left,
       mapping = aes(y = outcome)) +
  geom_pointrange(mapping = aes(x = center,
                                y = outcome,
                                xmin = `2.5 %`,
                                xmax = `97.5 %`,
                                shape = factor(model)),
                  data = ci_left,
                  position = position_dodge(width = 0.4),
                  fatten=5,
                  alpha=.8) +
  scale_y_discrete(limits=c("a (interval)","a (both)","b (interval)","b (both)"))+
  geom_vline(xintercept = 0, 
             color = "red", 
             alpha = 0.66, 
             show.legend = FALSE) +
  theme_bw() +
  labs(#title = "(b) Effect of information treatments (both, interval) relative to best guess, confirmation treatments",
       y = "Ambiguity Index", 
       x = "Estimate",
       shape="Control variables")
```

## Right Panel

```{r data_right}
ci_right <- data.table()
for(RHS in c("none", "demographics", "all")){
  for(LHS in c("a", "b")){
    ols <- lm(formula = reformulate(termlabels = get(RHS), 
                                    response = LHS),
              data = subset1,
              subset = (surprise == TRUE))
    for(communication in c("interval", "both")){
      tmp <- coefci(x = ols,
                    parm = paste0("communication", communication, ":treatedTRUE"),
                    vcov = vcovCL(x = ols, 
                                  cluster = subset1[surprise == TRUE,
                                                 participant.label], 
                                  type = "HC1"),
                    level = 0.95) %>% 
        data.table(model = RHS, outcome = paste0(LHS, " (", communication, ")"))
      tmp[, center := (`2.5 %` + `97.5 %`)/2]
      
      ci_right <- rbind(ci_right, tmp)
    }
  }
}
```

```{r}
ci_right %>% head(n = 7) %>% kable()
```

```{r viz_right}
right <- ggplot(data = ci_right,
       mapping = aes(y = outcome)) +
  geom_pointrange(mapping = aes(x = center,
                                y = outcome,
                                xmin = `2.5 %`,
                                xmax = `97.5 %`,
                                shape = factor(model)),
                  data = ci_right,
                  position = position_dodge(width = 0.4),
                  fatten=5,
                  alpha=.8) +
  geom_vline(xintercept = 0, 
             color = "red", 
             alpha = 0.66, 
             show.legend = FALSE) +
  theme_bw() +
  labs(#title = "(c) Effect of information treatments (both, interval) relative to best guess, contradiction treatments",
       y = "Ambiguity Index", 
       x = "Estimate",
       shape="Control variables") +
  scale_y_discrete(position = "right",limits=c("a (interval)","a (both)","b (interval)","b (both)"))
```

## Assemble Top, Left and Right Panels

As before, we use the `{{patchwork}}` package to assmble the plot objects.

```{r fig_3}
#| label: fig-od1
#| fig-cap: 'Treatment effects of regression equation (1) with dependent variables b and a. Estimators with 95% confidence intervals. The underlying standard errors (“HC1”) are clustered at the individual level and estimated with the R package sandwich (Zeileis, 2004; Zeileis et al., 2020).'
(top / (left | right) & theme(legend.position = "bottom")) + plot_layout(guides = "collect")
```


# Figure OD.2

The process of producing @fig-od2 is very similar to the process of @fig-od1. The only difference is that we do not loop through the outcomes `a` and `b` but the events' matching probabilities (`E1`, `E2`, `...`, `E23`).

To loop through these variables, we use a regex (`E\\d`) to create a vector called `events`.

```{r event_cols}
events <- names(data) %>% str_subset(pattern = "E\\d")
```

Because the process is, from now on, so similar to the process of @fig-3, we do not comment it any further here.

## Top Panel

```{r covariates_top_4}
none <- c("surprise", "treated", "surprise*treated")

demographics <- c(none, "age_35_52","age_53_plus","female", "high_education", "high_income", "married", "parentship")

all <- c(demographics, "high_temperature","high_usage","high_general_risk","high_weather_risk","high_accuracy","high_credibility")
```

```{r data_top_4}
ci_top <- data.table()
for(RHS in c("none", "demographics", "all")){
  for(LHS in events){
    ols <- lm(formula = reformulate(termlabels = get(RHS), 
                                    response = LHS),
              data = subset1)
    
    tmp <- coefci(x = ols,
                  parm = "surpriseTRUE:treatedTRUE",
                  vcov = vcovCL(x = ols, 
                                cluster = subset1$participant.label, 
                                type = "HC1"),
                  level = 0.95) %>% data.table(model = RHS, outcome = LHS)
    tmp[, center := (`2.5 %` + `97.5 %`)/2]
    
    ci_top <- rbind(ci_top, tmp)
  }
}
```

```{r}
ci_top %>% head(n = 7) %>% kable()
```

```{r viz_top_4}
top <- ggplot(data = ci_top,
       mapping = aes(y = outcome)) +
  geom_pointrange(mapping = aes(x = center,
                                y = outcome,
                                xmin = `2.5 %`,
                                xmax = `97.5 %`,
                                shape = factor(model)),
                  data = ci_top,
                  position = position_dodge(width = 0.4),
                  fatten=5,
                  alpha=.8) +
  scale_y_discrete(limits=c("E13","E23","E12","E3","E2","E1"))+
  geom_vline(xintercept = 0, 
             color = "red", 
             alpha = 0.66, 
             show.legend = FALSE) +
  theme_bw() +
  labs(y = "Ambiguity Index", 
       x = "Estimate",
       shape="Control variables")
```

## Left Panel

```{r covariates_left_4}
none <- c("communication", "treated", "communication*treated")

demographics <- c(none, "age_35_52","age_53_plus","female", "high_education", "high_income", "married", "parentship")

all <- c(demographics, "high_temperature","high_usage","high_general_risk","high_weather_risk","high_accuracy","high_credibility")
```

```{r data_left_4}
ci_left <- data.table()
for(RHS in c("none", "demographics", "all")){
  for(LHS in events){
    ols <- lm(formula = reformulate(termlabels = get(RHS), 
                                    response = LHS),
              data = subset1,
              subset = (surprise == FALSE))
    for(communication in c("interval", "both")){
      tmp <- coefci(x = ols,
                    parm = paste0("communication", communication, ":treatedTRUE"),
                    vcov = vcovCL(x = ols, 
                                  cluster = subset1[surprise == FALSE,
                                                 participant.label], 
                                  type = "HC1"),
                    level = 0.95) %>% 
        data.table(model = RHS, outcome = paste0(LHS, " (", communication, ")"))
      tmp[, center := (`2.5 %` + `97.5 %`)/2]
      
      ci_left <- rbind(ci_left, tmp)
    }
  }
}
```

```{r}
ci_left %>% head(n = 7) %>% kable()
```

```{r viz_left_4}
left <- ggplot(data = ci_left,
       mapping = aes(y = outcome)) +
  geom_pointrange(mapping = aes(x = center,
                                y = outcome,
                                xmin = `2.5 %`,
                                xmax = `97.5 %`,
                                shape = factor(model)),
                  data = ci_left,
                  position = position_dodge(width = 0.4),
                  fatten=5,
                  alpha=.8) +
  scale_y_discrete(limits=c("E13 (interval)","E13 (both)","E23 (interval)","E23 (both)","E12 (interval)","E12 (both)","E3 (interval)","E3 (both)","E2 (interval)","E2 (both)","E1 (interval)","E1 (both)"))+
  geom_vline(xintercept = 0, 
             color = "red", 
             alpha = 0.66, 
             show.legend = FALSE) +
  theme_bw() +
  labs(y = "Ambiguity Index", 
       x = "Estimate",
       shape="Control variables")
```

## Right Panel

```{r data_right_4}
ci_right <- data.table()
for(RHS in c("none", "demographics", "all")){
  for(LHS in events){
    ols <- lm(formula = reformulate(termlabels = get(RHS), 
                                    response = LHS),
              data = subset1,
              subset = (surprise == TRUE))
    for(communication in c("interval", "both")){
      tmp <- coefci(x = ols,
                    parm = paste0("communication", communication, ":treatedTRUE"),
                    vcov = vcovCL(x = ols, 
                                  cluster = subset1[surprise == TRUE,
                                                 participant.label], 
                                  type = "HC1"),
                    level = 0.95) %>% 
        data.table(model = RHS, outcome = paste0(LHS, " (", communication, ")"))
      tmp[, center := (`2.5 %` + `97.5 %`)/2]
      
      ci_right <- rbind(ci_right, tmp)
    }
  }
}
```

```{r}
ci_right %>% head(n = 7) %>% kable()
```

```{r viz_right_4}
right <- ggplot(data = ci_right,
       mapping = aes(y = outcome)) +
  geom_pointrange(mapping = aes(x = center,
                                y = outcome,
                                xmin = `2.5 %`,
                                xmax = `97.5 %`,
                                shape = factor(model)),
                  data = ci_right,
                  position = position_dodge(width = 0.4),
                  fatten=5,
                  alpha=.8) +
  geom_vline(xintercept = 0, 
             color = "red", 
             alpha = 0.66, 
             show.legend = FALSE) +
  theme_bw() +
  labs(y = "Ambiguity Index", 
       x = "Estimate",
       shape="Control variables") +
  scale_y_discrete(position = "right",limits=c("E13 (interval)","E13 (both)","E23 (interval)","E23 (both)","E12 (interval)","E12 (both)","E3 (interval)","E3 (both)","E2 (interval)","E2 (both)","E1 (interval)","E1 (both)"))
```

## Assemble Top, Left and Right Panels

```{r fig_od2}
#| label: fig-od2
#| fig-cap: 'Treatment effects of regression equation (1) with matching probabilities for all events as depen- dent variables. Estimators with 95% confidence intervals. The underlying standard errors (“HC1”) are clustered at the individual level and estimated with the R package sandwich (Zeileis, 2004; Zeileis et al., 2020).'

(top / (left | right) & theme(legend.position = "bottom")) + plot_layout(guides = "collect")
```

#Table OD.3, OD.4

## b Subset 2

```{r b2}
#| results: asis
event_regressions(event = "b",data2=subset2)
```

## a SUbset2

```{r a2}
#| results: asis
event_regressions(event = "a",data2=subset2)
```

# Figure OD.3

@fig-od3 also presents three panels. These panels visualize confidence intervals of our estimator of interest: the interaction of `stage` and `surprise` (top panel) as well as the interaction between `stage` and `communication` in the lower two panels.

The corresponding data stems from many OLS regressions and are computed in for-loops. Even though the code differs slightly, it is very repetitive between the three panels, which is why we only explain the top panel

## Top Panel 2

Before calculating the data based on OLS regressions, we specify three different models: `none` represents only treatment variables, `demographics` extends the former by adding demographic variables, and `all` extends the former two by also adding all remaining covariates.

```{r covariates_top2}
none <- c("surprise", "treated", "surprise*treated")

demographics <- c(none, "age_35_52","age_53_plus","female", "high_education", "high_income", "married", "parentship")

all <- c(demographics, "high_temperature","high_usage","high_general_risk","high_weather_risk","high_accuracy","high_credibility")
```

Next, we run a nested loop that iterates through all three models and within these models through both ambiguity indices `a` and `b`. From these ols regressions, we compute clustered standard errors using the `{{sandwich}}` and `{{lmtest}}` package. The resuling data is stored in a temporary data.table that is appended to an initially empty data.table called `ci_top`.

```{r data_top2}
ci_top <- data.table()
for(RHS in c("none", "demographics", "all")){
  for(LHS in c("a", "b")){
    ols <- lm(formula = reformulate(termlabels = get(RHS), 
                                    response = LHS),
              data = subset2)
    
    tmp <- coefci(x = ols,
                  parm = "surpriseTRUE:treatedTRUE",
                  vcov = vcovCL(x = ols, 
                                cluster = subset2$participant.label, 
                                type = "HC1"),
                  level = 0.95) %>% 
      data.table(model = RHS, outcome = LHS)
    tmp[, center := (`2.5 %` + `97.5 %`)/2]
    
    ci_top <- rbind(ci_top, tmp)
  }
}
```

The result looks as follows. The data.table provides a column for the 2.5% and 97.5% confidence interval, the center of the two, as well as the ols specification as presented in `model` and `outcome`.

```{r2}
ci_top %>% head(n = 7) %>% kable()
```

Finally, we plot this data set (`ci_top`) using the `{{ggplot2}}` package. The resulting object is stored as `top` and will be assembled together with the other two panels.

```{r viz_top2}
top <- ggplot(data = ci_top,
              mapping = aes(y = outcome)) +
  geom_pointrange(mapping = aes(x = center,
                                y = outcome,
                                xmin = `2.5 %`,
                                xmax = `97.5 %`,
                                shape = factor(model)),
                  data = ci_top,
                  position = position_dodge(width = 0.4),
                  fatten=5,
                  alpha=.8) +
  geom_vline(xintercept = 0, 
             color = "red", 
             alpha = 0.66, 
             show.legend = FALSE) +
  theme_bw() +
  labs(#title = "(a) Effect of contradiction (relative to confirmation)",
    y = "Ambiguity Index", 
    x = "Estimate",
    shape="Control variables")
```

## Left Panel 2

```{r covariates_left2}
none <- c("communication", "treated", "communication*treated")

demographics <- c(none, "age_35_52","age_53_plus","female", "high_education", "high_income", "married", "parentship")

all <- c(demographics, "high_temperature","high_usage","high_general_risk","high_weather_risk","high_accuracy","high_credibility")
```

```{r data_left2}
ci_left <- data.table()
for(RHS in c("none", "demographics", "all")){
  for(LHS in c("a", "b")){
    ols <- lm(formula = reformulate(termlabels = get(RHS), 
                                    response = LHS),
              data = subset2,
              subset = (surprise == FALSE))
    for(communication in c("interval", "both")){
      tmp <- coefci(x = ols,
                    parm = paste0("communication", communication, ":treatedTRUE"),
                    vcov = vcovCL(x = ols, 
                                  cluster = subset2[surprise == FALSE,
                                                    participant.label], 
                                  type = "HC1"),
                    level = 0.95) %>% 
        data.table(model = RHS, outcome = paste0(LHS, " (", communication, ")"))
      tmp[, center := (`2.5 %` + `97.5 %`)/2]
      
      ci_left <- rbind(ci_left, tmp)
    }
  }
}
```

```{r2}
ci_left %>% head(n = 7) %>% kable()
```

```{r viz_left2}
left <- ggplot(data = ci_left,
               mapping = aes(y = outcome)) +
  geom_pointrange(mapping = aes(x = center,
                                y = outcome,
                                xmin = `2.5 %`,
                                xmax = `97.5 %`,
                                shape = factor(model)),
                  data = ci_left,
                  position = position_dodge(width = 0.4),
                  fatten=5,
                  alpha=.8) +
  scale_y_discrete(limits=c("a (interval)","a (both)","b (interval)","b (both)"))+
  geom_vline(xintercept = 0, 
             color = "red", 
             alpha = 0.66, 
             show.legend = FALSE) +
  theme_bw() +
  labs(#title = "(b) Effect of information treatments (both, interval) relative to best guess, confirmation treatments",
    y = "Ambiguity Index", 
    x = "Estimate",
    shape="Control variables")
```

## Right Panel 2

```{r data_right2}
ci_right <- data.table()
for(RHS in c("none", "demographics", "all")){
  for(LHS in c("a", "b")){
    ols <- lm(formula = reformulate(termlabels = get(RHS), 
                                    response = LHS),
              data = subset2,
              subset = (surprise == TRUE))
    for(communication in c("interval", "both")){
      tmp <- coefci(x = ols,
                    parm = paste0("communication", communication, ":treatedTRUE"),
                    vcov = vcovCL(x = ols, 
                                  cluster = subset2[surprise == TRUE,
                                                    participant.label], 
                                  type = "HC1"),
                    level = 0.95) %>% 
        data.table(model = RHS, outcome = paste0(LHS, " (", communication, ")"))
      tmp[, center := (`2.5 %` + `97.5 %`)/2]
      
      ci_right <- rbind(ci_right, tmp)
    }
  }
}
```

```{r222}
ci_right %>% head(n = 7) %>% kable()
```

```{r viz_right2}
right <- ggplot(data = ci_right,
                mapping = aes(y = outcome)) +
  geom_pointrange(mapping = aes(x = center,
                                y = outcome,
                                xmin = `2.5 %`,
                                xmax = `97.5 %`,
                                shape = factor(model)),
                  data = ci_right,
                  position = position_dodge(width = 0.4),
                  fatten=5,
                  alpha=.8) +
  geom_vline(xintercept = 0, 
             color = "red", 
             alpha = 0.66, 
             show.legend = FALSE) +
  theme_bw() +
  labs(#title = "(c) Effect of information treatments (both, interval) relative to best guess, contradiction treatments",
    y = "Ambiguity Index", 
    x = "Estimate",
    shape="Control variables") +
  scale_y_discrete(position = "right",limits=c("a (interval)","a (both)","b (interval)","b (both)"))
```
 
## Assemble Top, Left and Right Panels 2

As before, we use the `{{patchwork}}` package to assmble the plot objects.

```{r fig_32}
#| label: fig-od3
#| fig-cap: 'Treatment effects of regression equation (1) with dependent variables b and a. Estimators with 95% confidence intervals. The underlying standard errors (“HC1”) are clustered at the individual level and estimated with the R package sandwich (Zeileis, 2004; Zeileis et al., 2020).'
(top / (left | right) & theme(legend.position = "bottom")) + plot_layout(guides = "collect")
```

# Figure OD.4

The process of producing @fig-od4 is very similar to the process of @fig-od3. The only difference is that we do not loop through the outcomes `a` and `b` but the events' matching probabilities (`E1`, `E2`, `...`, `E23`).

To loop through these variables, we use a regex (`E\\d`) to create a vector called `events`.

```{r event_cols2}
events <- names(data) %>% str_subset(pattern = "E\\d")
```

Because the process is, from now on, so similar to the process of @fig-3, we do not comment it any further here.

## Top Panel 2

```{r covariates_top_42}
none <- c("surprise", "treated", "surprise*treated")

demographics <- c(none, "age_35_52","age_53_plus","female", "high_education", "high_income", "married", "parentship")

all <- c(demographics, "high_temperature","high_usage","high_general_risk","high_weather_risk","high_accuracy","high_credibility")
```

```{r data_top_42}
ci_top <- data.table()
for(RHS in c("none", "demographics", "all")){
  for(LHS in events){
    ols <- lm(formula = reformulate(termlabels = get(RHS), 
                                    response = LHS),
              data = subset2)
    
    tmp <- coefci(x = ols,
                  parm = "surpriseTRUE:treatedTRUE",
                  vcov = vcovCL(x = ols, 
                                cluster = subset2$participant.label, 
                                type = "HC1"),
                  level = 0.95) %>% data.table(model = RHS, outcome = LHS)
    tmp[, center := (`2.5 %` + `97.5 %`)/2]
    
    ci_top <- rbind(ci_top, tmp)
  }
}
```

```{r23}
ci_top %>% head(n = 7) %>% kable()
```

```{r viz_top_42}
top <- ggplot(data = ci_top,
       mapping = aes(y = outcome)) +
  geom_pointrange(mapping = aes(x = center,
                                y = outcome,
                                xmin = `2.5 %`,
                                xmax = `97.5 %`,
                                shape = factor(model)),
                  data = ci_top,
                  position = position_dodge(width = 0.4),
                  fatten=5,
                  alpha=.8) +
  scale_y_discrete(limits=c("E13","E23","E12","E3","E2","E1"))+
  geom_vline(xintercept = 0, 
             color = "red", 
             alpha = 0.66, 
             show.legend = FALSE) +
  theme_bw() +
  labs(y = "Ambiguity Index", 
       x = "Estimate",
       shape="Control variables")
```

## Left Panel 2

```{r covariates_left_42}
none <- c("communication", "treated", "communication*treated")

demographics <- c(none, "age_35_52","age_53_plus","female", "high_education", "high_income", "married", "parentship")

all <- c(demographics, "high_temperature","high_usage","high_general_risk","high_weather_risk","high_accuracy","high_credibility")
```

```{r data_left_42}
ci_left <- data.table()
for(RHS in c("none", "demographics", "all")){
  for(LHS in events){
    ols <- lm(formula = reformulate(termlabels = get(RHS), 
                                    response = LHS),
              data = subset2,
              subset = (surprise == FALSE))
    for(communication in c("interval", "both")){
      tmp <- coefci(x = ols,
                    parm = paste0("communication", communication, ":treatedTRUE"),
                    vcov = vcovCL(x = ols, 
                                  cluster = subset2[surprise == FALSE,
                                                 participant.label], 
                                  type = "HC1"),
                    level = 0.95) %>% 
        data.table(model = RHS, outcome = paste0(LHS, " (", communication, ")"))
      tmp[, center := (`2.5 %` + `97.5 %`)/2]
      
      ci_left <- rbind(ci_left, tmp)
    }
  }
}
```

```{r23}
ci_left %>% head(n = 7) %>% kable()
```

```{r viz_left_42}
left <- ggplot(data = ci_left,
       mapping = aes(y = outcome)) +
  geom_pointrange(mapping = aes(x = center,
                                y = outcome,
                                xmin = `2.5 %`,
                                xmax = `97.5 %`,
                                shape = factor(model)),
                  data = ci_left,
                  position = position_dodge(width = 0.4),
                  fatten=5,
                  alpha=.8) +
  scale_y_discrete(limits=c("E13 (interval)","E13 (both)","E23 (interval)","E23 (both)","E12 (interval)","E12 (both)","E3 (interval)","E3 (both)","E2 (interval)","E2 (both)","E1 (interval)","E1 (both)"))+
  geom_vline(xintercept = 0, 
             color = "red", 
             alpha = 0.66, 
             show.legend = FALSE) +
  theme_bw() +
  labs(y = "Ambiguity Index", 
       x = "Estimate",
       shape="Control variables")
```

## Right Panel 2

```{r data_right_42}
ci_right <- data.table()
for(RHS in c("none", "demographics", "all")){
  for(LHS in events){
    ols <- lm(formula = reformulate(termlabels = get(RHS), 
                                    response = LHS),
              data = subset2,
              subset = (surprise == TRUE))
    for(communication in c("interval", "both")){
      tmp <- coefci(x = ols,
                    parm = paste0("communication", communication, ":treatedTRUE"),
                    vcov = vcovCL(x = ols, 
                                  cluster = subset2[surprise == TRUE,
                                                 participant.label], 
                                  type = "HC1"),
                    level = 0.95) %>% 
        data.table(model = RHS, outcome = paste0(LHS, " (", communication, ")"))
      tmp[, center := (`2.5 %` + `97.5 %`)/2]
      
      ci_right <- rbind(ci_right, tmp)
    }
  }
}
```

```{r22}
ci_right %>% head(n = 7) %>% kable()
```

```{r viz_right_42}
right <- ggplot(data = ci_right,
       mapping = aes(y = outcome)) +
  geom_pointrange(mapping = aes(x = center,
                                y = outcome,
                                xmin = `2.5 %`,
                                xmax = `97.5 %`,
                                shape = factor(model)),
                  data = ci_right,
                  position = position_dodge(width = 0.4),
                  fatten=5,
                  alpha=.8) +
  geom_vline(xintercept = 0, 
             color = "red", 
             alpha = 0.66, 
             show.legend = FALSE) +
  theme_bw() +
  labs(y = "Ambiguity Index", 
       x = "Estimate",
       shape="Control variables") +
  scale_y_discrete(position = "right",limits=c("E13 (interval)","E13 (both)","E23 (interval)","E23 (both)","E12 (interval)","E12 (both)","E3 (interval)","E3 (both)","E2 (interval)","E2 (both)","E1 (interval)","E1 (both)"))
```

## Assemble Top, Left and Right Panels 2

```{r fig_od4}
#| label: fig-od4
#| fig-cap: 'Treatment effects of regression equation (1) with matching probabilities for all events as depen- dent variables. Estimators with 95% confidence intervals. The underlying standard errors (“HC1”) are clustered at the individual level and estimated with the R package sandwich (Zeileis, 2004; Zeileis et al., 2020).'

(top / (left | right) & theme(legend.position = "bottom")) + plot_layout(guides = "collect")
```


#Table OD.5, OD.6


## b 3

```{r b34}
#| results: asis
event_regressions(event = "b",data2=subset3)
```
 
## a 3

```{r a34}
#| results: asis
event_regressions(event = "a",data2=subset3)
```

# Figure OD.5

@fig-od1 also presents three panels. These panels visualize confidence intervals of our estimator of interest: the interaction of `stage` and `surprise` (top panel) as well as the interaction between `stage` and `communication` in the lower two panels.

The corresponding data stems from many OLS regressions and are computed in for-loops. Even though the code differs slightly, it is very repetitive between the three panels, which is why we only explain the top panel

## Top Panel 3

Before calculating the data based on OLS regressions, we specify three different models: `none` represents only treatment variables, `demographics` extends the former by adding demographic variables, and `all` extends the former two by also adding all remaining covariates.

```{r covariates_top37}
none <- c("surprise", "treated", "surprise*treated")

demographics <- c(none, "age_35_52","age_53_plus","female", "high_education", "high_income", "married", "parentship")

all <- c(demographics, "high_temperature","high_usage","high_general_risk","high_weather_risk","high_accuracy","high_credibility")
```

Next, we run a nested loop that iterates through all three models and within these models through both ambiguity indices `a` and `b`. From these ols regressions, we compute clustered standard errors using the `{{sandwich}}` and `{{lmtest}}` package. The resuling data is stored in a temporary data.table that is appended to an initially empty data.table called `ci_top`.

```{r data_top37}
ci_top <- data.table()
for(RHS in c("none", "demographics", "all")){
  for(LHS in c("a", "b")){
    ols <- lm(formula = reformulate(termlabels = get(RHS), 
                                    response = LHS),
              data = subset3)
    
    tmp <- coefci(x = ols,
                  parm = "surpriseTRUE:treatedTRUE",
                  vcov = vcovCL(x = ols, 
                                cluster = subset3$participant.label, 
                                type = "HC1"),
                  level = 0.95) %>% 
      data.table(model = RHS, outcome = LHS)
    tmp[, center := (`2.5 %` + `97.5 %`)/2]
    
    ci_top <- rbind(ci_top, tmp)
  }
}
```

The result looks as follows. The data.table provides a column for the 2.5% and 97.5% confidence interval, the center of the two, as well as the ols specification as presented in `model` and `outcome`.

```{r3447}
ci_top %>% head(n = 7) %>% kable()
```

Finally, we plot this data set (`ci_top`) using the `{{ggplot2}}` package. The resulting object is stored as `top` and will be assembled together with the other two panels.

```{r viz_top37}
top <- ggplot(data = ci_top,
              mapping = aes(y = outcome)) +
  geom_pointrange(mapping = aes(x = center,
                                y = outcome,
                                xmin = `2.5 %`,
                                xmax = `97.5 %`,
                                shape = factor(model)),
                  data = ci_top,
                  position = position_dodge(width = 0.4),
                  fatten=5,
                  alpha=.8) +
  geom_vline(xintercept = 0, 
             color = "red", 
             alpha = 0.66, 
             show.legend = FALSE) +
  theme_bw() +
  labs(#title = "(a) Effect of contradiction (relative to confirmation)",
    y = "Ambiguity Index", 
    x = "Estimate",
    shape="Control variables")
```

## Left Panel 3

```{r covariates_left37}
none <- c("communication", "treated", "communication*treated")

demographics <- c(none, "age_35_52","age_53_plus","female", "high_education", "high_income", "married", "parentship")

all <- c(demographics, "high_temperature","high_usage","high_general_risk","high_weather_risk","high_accuracy","high_credibility")
```

```{r data_left37}
ci_left <- data.table()
for(RHS in c("none", "demographics", "all")){
  for(LHS in c("a", "b")){
    ols <- lm(formula = reformulate(termlabels = get(RHS), 
                                    response = LHS),
              data = subset3,
              subset = (surprise == FALSE))
    for(communication in c("interval", "both")){
      tmp <- coefci(x = ols,
                    parm = paste0("communication", communication, ":treatedTRUE"),
                    vcov = vcovCL(x = ols, 
                                  cluster = subset3[surprise == FALSE,
                                                    participant.label], 
                                  type = "HC1"),
                    level = 0.95) %>% 
        data.table(model = RHS, outcome = paste0(LHS, " (", communication, ")"))
      tmp[, center := (`2.5 %` + `97.5 %`)/2]
      
      ci_left <- rbind(ci_left, tmp)
    }
  }
}
```

```{r34447}
ci_left %>% head(n = 7) %>% kable()
```

```{r viz_left37}
left <- ggplot(data = ci_left,
               mapping = aes(y = outcome)) +
  geom_pointrange(mapping = aes(x = center,
                                y = outcome,
                                xmin = `2.5 %`,
                                xmax = `97.5 %`,
                                shape = factor(model)),
                  data = ci_left,
                  position = position_dodge(width = 0.4),
                  fatten=5,
                  alpha=.8) +
  scale_y_discrete(limits=c("a (interval)","a (both)","b (interval)","b (both)"))+
  geom_vline(xintercept = 0, 
             color = "red", 
             alpha = 0.66, 
             show.legend = FALSE) +
  theme_bw() +
  labs(#title = "(b) Effect of information treatments (both, interval) relative to best guess, confirmation treatments",
    y = "Ambiguity Index", 
    x = "Estimate",
    shape="Control variables")
```

## Right Panel 3

```{r data_right37}
ci_right <- data.table()
for(RHS in c("none", "demographics", "all")){
  for(LHS in c("a", "b")){
    ols <- lm(formula = reformulate(termlabels = get(RHS), 
                                    response = LHS),
              data = subset3,
              subset = (surprise == TRUE))
    for(communication in c("interval", "both")){
      tmp <- coefci(x = ols,
                    parm = paste0("communication", communication, ":treatedTRUE"),
                    vcov = vcovCL(x = ols, 
                                  cluster = subset3[surprise == TRUE,
                                                    participant.label], 
                                  type = "HC1"),
                    level = 0.95) %>% 
        data.table(model = RHS, outcome = paste0(LHS, " (", communication, ")"))
      tmp[, center := (`2.5 %` + `97.5 %`)/2]
      
      ci_right <- rbind(ci_right, tmp)
    }
  }
}
```

```{r343447}
ci_right %>% head(n = 7) %>% kable()
```

```{r viz_right37}
right <- ggplot(data = ci_right,
                mapping = aes(y = outcome)) +
  geom_pointrange(mapping = aes(x = center,
                                y = outcome,
                                xmin = `2.5 %`,
                                xmax = `97.5 %`,
                                shape = factor(model)),
                  data = ci_right,
                  position = position_dodge(width = 0.4),
                  fatten=5,
                  alpha=.8) +
  geom_vline(xintercept = 0, 
             color = "red", 
             alpha = 0.66, 
             show.legend = FALSE) +
  theme_bw() +
  labs(#title = "(c) Effect of information treatments (both, interval) relative to best guess, contradiction treatments",
    y = "Ambiguity Index", 
    x = "Estimate",
    shape="Control variables") +
  scale_y_discrete(position = "right",limits=c("a (interval)","a (both)","b (interval)","b (both)"))
```

## Assemble Top, Left and Right Panels 3

As before, we use the `{{patchwork}}` package to assmble the plot objects.

```{r fig_od5}
#| label: fig-od5
#| fig-cap: 'Treatment effects of regression equation (1) with dependent variables b and a. Estimators with 95% confidence intervals. The underlying standard errors (“HC1”) are clustered at the individual level and estimated with the R package sandwich (Zeileis, 2004; Zeileis et al., 2020).'
(top / (left | right) & theme(legend.position = "bottom")) + plot_layout(guides = "collect")
```

# Figure OD.6

The process of producing @fig-od2 is very similar to the process of @fig-od1. The only difference is that we do not loop through the outcomes `a` and `b` but the events' matching probabilities (`E1`, `E2`, `...`, `E23`).

To loop through these variables, we use a regex (`E\\d`) to create a vector called `events`.

```{r event_cols33}
events <- names(data) %>% str_subset(pattern = "E\\d")
```

Because the process is, from now on, so similar to the process of @fig-3, we do not comment it any further here.

## Top Panel 3

```{r covariates_top_33}
none <- c("surprise", "treated", "surprise*treated")

demographics <- c(none, "age_35_52","age_53_plus","female", "high_education", "high_income", "married", "parentship")

all <- c(demographics, "high_temperature","high_usage","high_general_risk","high_weather_risk","high_accuracy","high_credibility")
```

```{r data_top_33}
ci_top <- data.table()
for(RHS in c("none", "demographics", "all")){
  for(LHS in events){
    ols <- lm(formula = reformulate(termlabels = get(RHS), 
                                    response = LHS),
              data = subset3)
    
    tmp <- coefci(x = ols,
                  parm = "surpriseTRUE:treatedTRUE",
                  vcov = vcovCL(x = ols, 
                                cluster = subset3$participant.label, 
                                type = "HC1"),
                  level = 0.95) %>% data.table(model = RHS, outcome = LHS)
    tmp[, center := (`2.5 %` + `97.5 %`)/2]
    
    ci_top <- rbind(ci_top, tmp)
  }
}
```

```{r3434343}
ci_top %>% head(n = 7) %>% kable()
```

```{r viz_top_33}
top <- ggplot(data = ci_top,
       mapping = aes(y = outcome)) +
  geom_pointrange(mapping = aes(x = center,
                                y = outcome,
                                xmin = `2.5 %`,
                                xmax = `97.5 %`,
                                shape = factor(model)),
                  data = ci_top,
                  position = position_dodge(width = 0.4),
                  fatten=5,
                  alpha=.8) +
  scale_y_discrete(limits=c("E13","E23","E12","E3","E2","E1"))+
  geom_vline(xintercept = 0, 
             color = "red", 
             alpha = 0.66, 
             show.legend = FALSE) +
  theme_bw() +
  labs(y = "Ambiguity Index", 
       x = "Estimate",
       shape="Control variables")
```

## Left Panel 3

```{r covariates_left_33}
none <- c("communication", "treated", "communication*treated")

demographics <- c(none, "age_35_52","age_53_plus","female", "high_education", "high_income", "married", "parentship")

all <- c(demographics, "high_temperature","high_usage","high_general_risk","high_weather_risk","high_accuracy","high_credibility")
```

```{r data_left_33}
ci_left <- data.table()
for(RHS in c("none", "demographics", "all")){
  for(LHS in events){
    ols <- lm(formula = reformulate(termlabels = get(RHS), 
                                    response = LHS),
              data = subset3,
              subset = (surprise == FALSE))
    for(communication in c("interval", "both")){
      tmp <- coefci(x = ols,
                    parm = paste0("communication", communication, ":treatedTRUE"),
                    vcov = vcovCL(x = ols, 
                                  cluster = subset3[surprise == FALSE,
                                                 participant.label], 
                                  type = "HC1"),
                    level = 0.95) %>% 
        data.table(model = RHS, outcome = paste0(LHS, " (", communication, ")"))
      tmp[, center := (`2.5 %` + `97.5 %`)/2]
      
      ci_left <- rbind(ci_left, tmp)
    }
  }
}
```

```{r34344333}
ci_left %>% head(n = 7) %>% kable()
```

```{r viz_left_33}
left <- ggplot(data = ci_left,
       mapping = aes(y = outcome)) +
  geom_pointrange(mapping = aes(x = center,
                                y = outcome,
                                xmin = `2.5 %`,
                                xmax = `97.5 %`,
                                shape = factor(model)),
                  data = ci_left,
                  position = position_dodge(width = 0.4),
                  fatten=5,
                  alpha=.8) +
  scale_y_discrete(limits=c("E13 (interval)","E13 (both)","E23 (interval)","E23 (both)","E12 (interval)","E12 (both)","E3 (interval)","E3 (both)","E2 (interval)","E2 (both)","E1 (interval)","E1 (both)"))+
  geom_vline(xintercept = 0, 
             color = "red", 
             alpha = 0.66, 
             show.legend = FALSE) +
  theme_bw() +
  labs(y = "Ambiguity Index", 
       x = "Estimate",
       shape="Control variables")
```

## Right Panel 3

```{r data_right_433}
ci_right <- data.table()
for(RHS in c("none", "demographics", "all")){
  for(LHS in events){
    ols <- lm(formula = reformulate(termlabels = get(RHS), 
                                    response = LHS),
              data = subset3,
              subset = (surprise == TRUE))
    for(communication in c("interval", "both")){
      tmp <- coefci(x = ols,
                    parm = paste0("communication", communication, ":treatedTRUE"),
                    vcov = vcovCL(x = ols, 
                                  cluster = subset3[surprise == TRUE,
                                                 participant.label], 
                                  type = "HC1"),
                    level = 0.95) %>% 
        data.table(model = RHS, outcome = paste0(LHS, " (", communication, ")"))
      tmp[, center := (`2.5 %` + `97.5 %`)/2]
      
      ci_right <- rbind(ci_right, tmp)
    }
  }
}
```

```{r34343}
ci_right %>% head(n = 7) %>% kable()
```

```{r viz_right_433}
right <- ggplot(data = ci_right,
       mapping = aes(y = outcome)) +
  geom_pointrange(mapping = aes(x = center,
                                y = outcome,
                                xmin = `2.5 %`,
                                xmax = `97.5 %`,
                                shape = factor(model)),
                  data = ci_right,
                  position = position_dodge(width = 0.4),
                  fatten=5,
                  alpha=.8) +
  geom_vline(xintercept = 0, 
             color = "red", 
             alpha = 0.66, 
             show.legend = FALSE) +
  theme_bw() +
  labs(y = "Ambiguity Index", 
       x = "Estimate",
       shape="Control variables") +
  scale_y_discrete(position = "right",limits=c("E13 (interval)","E13 (both)","E23 (interval)","E23 (both)","E12 (interval)","E12 (both)","E3 (interval)","E3 (both)","E2 (interval)","E2 (both)","E1 (interval)","E1 (both)"))
```

## Assemble Top, Left and Right Panels 3

```{r fig_43}
#| label: fig-od6
#| fig-cap: 'Treatment effects of regression equation (1) with matching probabilities for all events as depen- dent variables. Estimators with 95% confidence intervals. The underlying standard errors (“HC1”) are clustered at the individual level and estimated with the R package sandwich (Zeileis, 2004; Zeileis et al., 2020).'

(top / (left | right) & theme(legend.position = "bottom")) + plot_layout(guides = "collect")
```



#Table OD.7, OD.8


## b 4

```{r b4}
#| results: asis
event_regressions(event = "b",data2=subset4)
```
 
## a 4

```{r a4}
#| results: asis
event_regressions(event = "a",data2=subset4)
```


# Figure OD.7

@fig-od1 also presents three panels. These panels visualize confidence intervals of our estimator of interest: the interaction of `stage` and `surprise` (top panel) as well as the interaction between `stage` and `communication` in the lower two panels.

The corresponding data stems from many OLS regressions and are computed in for-loops. Even though the code differs slightly, it is very repetitive between the three panels, which is why we only explain the top panel

## Top Panel9

Before calculating the data based on OLS regressions, we specify three different models: `none` represents only treatment variables, `demographics` extends the former by adding demographic variables, and `all` extends the former two by also adding all remaining covariates.

```{r covariates_top9}
none <- c("surprise", "treated", "surprise*treated")

demographics <- c(none, "age_35_52","age_53_plus","female", "high_education", "high_income", "married", "parentship")

all <- c(demographics, "high_temperature","high_usage","high_general_risk","high_weather_risk","high_accuracy","high_credibility")
```

Next, we run a nested loop that iterates through all three models and within these models through both ambiguity indices `a` and `b`. From these ols regressions, we compute clustered standard errors using the `{{sandwich}}` and `{{lmtest}}` package. The resuling data is stored in a temporary data.table that is appended to an initially empty data.table called `ci_top`.

```{r data_top9}
ci_top <- data.table()
for(RHS in c("none", "demographics", "all")){
  for(LHS in c("a", "b")){
    ols <- lm(formula = reformulate(termlabels = get(RHS), 
                                    response = LHS),
              data = subset4)
    
    tmp <- coefci(x = ols,
                  parm = "surpriseTRUE:treatedTRUE",
                  vcov = vcovCL(x = ols, 
                                cluster = subset4$participant.label, 
                                type = "HC1"),
                  level = 0.95) %>% 
      data.table(model = RHS, outcome = LHS)
    tmp[, center := (`2.5 %` + `97.5 %`)/2]
    
    ci_top <- rbind(ci_top, tmp)
  }
}
```

The result looks as follows. The data.table provides a column for the 2.5% and 97.5% confidence interval, the center of the two, as well as the ols specification as presented in `model` and `outcome`.

```{r99}
ci_top %>% head(n = 7) %>% kable()
```

Finally, we plot this data set (`ci_top`) using the `{{ggplot2}}` package. The resulting object is stored as `top` and will be assembled together with the other two panels.

```{r viz_top9}
top <- ggplot(data = ci_top,
              mapping = aes(y = outcome)) +
  geom_pointrange(mapping = aes(x = center,
                                y = outcome,
                                xmin = `2.5 %`,
                                xmax = `97.5 %`,
                                shape = factor(model)),
                  data = ci_top,
                  position = position_dodge(width = 0.4),
                  fatten=5,
                  alpha=.8) +
  geom_vline(xintercept = 0, 
             color = "red", 
             alpha = 0.66, 
             show.legend = FALSE) +
  theme_bw() +
  labs(#title = "(a) Effect of contradiction (relative to confirmation)",
    y = "Ambiguity Index", 
    x = "Estimate",
    shape="Control variables")
```

## Left Panel

```{r covariates_left9}
none <- c("communication", "treated", "communication*treated")

demographics <- c(none, "age_35_52","age_53_plus","female", "high_education", "high_income", "married", "parentship")

all <- c(demographics, "high_temperature","high_usage","high_general_risk","high_weather_risk","high_accuracy","high_credibility")
```

```{r data_left9}
ci_left <- data.table()
for(RHS in c("none", "demographics", "all")){
  for(LHS in c("a", "b")){
    ols <- lm(formula = reformulate(termlabels = get(RHS), 
                                    response = LHS),
              data = subset4,
              subset = (surprise == FALSE))
    for(communication in c("interval", "both")){
      tmp <- coefci(x = ols,
                    parm = paste0("communication", communication, ":treatedTRUE"),
                    vcov = vcovCL(x = ols, 
                                  cluster = subset4[surprise == FALSE,
                                                    participant.label], 
                                  type = "HC1"),
                    level = 0.95) %>% 
        data.table(model = RHS, outcome = paste0(LHS, " (", communication, ")"))
      tmp[, center := (`2.5 %` + `97.5 %`)/2]
      
      ci_left <- rbind(ci_left, tmp)
    }
  }
}
```

```{r9}
ci_left %>% head(n = 7) %>% kable()
```

```{r viz_left9}
left <- ggplot(data = ci_left,
               mapping = aes(y = outcome)) +
  geom_pointrange(mapping = aes(x = center,
                                y = outcome,
                                xmin = `2.5 %`,
                                xmax = `97.5 %`,
                                shape = factor(model)),
                  data = ci_left,
                  position = position_dodge(width = 0.4),
                  fatten=5,
                  alpha=.8) +
  scale_y_discrete(limits=c("a (interval)","a (both)","b (interval)","b (both)"))+
  geom_vline(xintercept = 0, 
             color = "red", 
             alpha = 0.66, 
             show.legend = FALSE) +
  theme_bw() +
  labs(#title = "(b) Effect of information treatments (both, interval) relative to best guess, confirmation treatments",
    y = "Ambiguity Index", 
    x = "Estimate",
    shape="Control variables")
```

## Right Panel

```{r data_right9}
ci_right <- data.table()
for(RHS in c("none", "demographics", "all")){
  for(LHS in c("a", "b")){
    ols <- lm(formula = reformulate(termlabels = get(RHS), 
                                    response = LHS),
              data = subset4,
              subset = (surprise == TRUE))
    for(communication in c("interval", "both")){
      tmp <- coefci(x = ols,
                    parm = paste0("communication", communication, ":treatedTRUE"),
                    vcov = vcovCL(x = ols, 
                                  cluster = subset4[surprise == TRUE,
                                                    participant.label], 
                                  type = "HC1"),
                    level = 0.95) %>% 
        data.table(model = RHS, outcome = paste0(LHS, " (", communication, ")"))
      tmp[, center := (`2.5 %` + `97.5 %`)/2]
      
      ci_right <- rbind(ci_right, tmp)
    }
  }
}
```

```{r98}
ci_right %>% head(n = 7) %>% kable()
```

```{r viz_right9}
right <- ggplot(data = ci_right,
                mapping = aes(y = outcome)) +
  geom_pointrange(mapping = aes(x = center,
                                y = outcome,
                                xmin = `2.5 %`,
                                xmax = `97.5 %`,
                                shape = factor(model)),
                  data = ci_right,
                  position = position_dodge(width = 0.4),
                  fatten=5,
                  alpha=.8) +
  geom_vline(xintercept = 0, 
             color = "red", 
             alpha = 0.66, 
             show.legend = FALSE) +
  theme_bw() +
  labs(#title = "(c) Effect of information treatments (both, interval) relative to best guess, contradiction treatments",
    y = "Ambiguity Index", 
    x = "Estimate",
    shape="Control variables") +
  scale_y_discrete(position = "right",limits=c("a (interval)","a (both)","b (interval)","b (both)"))
```

## Assemble Top, Left and Right Panels

As before, we use the `{{patchwork}}` package to assmble the plot objects.

```{r fig_39}
#| label: fig-od7
#| fig-cap: 'Treatment effects of regression equation (1) with dependent variables b and a. Estimators with 95% confidence intervals. The underlying standard errors (“HC1”) are clustered at the individual level and estimated with the R package sandwich (Zeileis, 2004; Zeileis et al., 2020).'
(top / (left | right) & theme(legend.position = "bottom")) + plot_layout(guides = "collect")
```


# Figure OD.8

The process of producing @fig-od2 is very similar to the process of @fig-od1. The only difference is that we do not loop through the outcomes `a` and `b` but the events' matching probabilities (`E1`, `E2`, `...`, `E23`).

To loop through these variables, we use a regex (`E\\d`) to create a vector called `events`.

```{r event_cols99}
events <- names(data) %>% str_subset(pattern = "E\\d")
```

Because the process is, from now on, so similar to the process of @fig-3, we do not comment it any further here.

## Top Panel

```{r covariates_top_49}
none <- c("surprise", "treated", "surprise*treated")

demographics <- c(none, "age_35_52","age_53_plus","female", "high_education", "high_income", "married", "parentship")

all <- c(demographics, "high_temperature","high_usage","high_general_risk","high_weather_risk","high_accuracy","high_credibility")
```

```{r data_top_49}
ci_top <- data.table()
for(RHS in c("none", "demographics", "all")){
  for(LHS in events){
    ols <- lm(formula = reformulate(termlabels = get(RHS), 
                                    response = LHS),
              data = subset4)
    
    tmp <- coefci(x = ols,
                  parm = "surpriseTRUE:treatedTRUE",
                  vcov = vcovCL(x = ols, 
                                cluster = subset4$participant.label, 
                                type = "HC1"),
                  level = 0.95) %>% data.table(model = RHS, outcome = LHS)
    tmp[, center := (`2.5 %` + `97.5 %`)/2]
    
    ci_top <- rbind(ci_top, tmp)
  }
}
```

```{r9898}
ci_top %>% head(n = 7) %>% kable()
```

```{r viz_top_49}
top <- ggplot(data = ci_top,
       mapping = aes(y = outcome)) +
  geom_pointrange(mapping = aes(x = center,
                                y = outcome,
                                xmin = `2.5 %`,
                                xmax = `97.5 %`,
                                shape = factor(model)),
                  data = ci_top,
                  position = position_dodge(width = 0.4),
                  fatten=5,
                  alpha=.8) +
  scale_y_discrete(limits=c("E13","E23","E12","E3","E2","E1"))+
  geom_vline(xintercept = 0, 
             color = "red", 
             alpha = 0.66, 
             show.legend = FALSE) +
  theme_bw() +
  labs(y = "Ambiguity Index", 
       x = "Estimate",
       shape="Control variables")
```

## Left Panel

```{r covariates_left_49}
none <- c("communication", "treated", "communication*treated")

demographics <- c(none, "age_35_52","age_53_plus","female", "high_education", "high_income", "married", "parentship")

all <- c(demographics, "high_temperature","high_usage","high_general_risk","high_weather_risk","high_accuracy","high_credibility")
```

```{r data_left_49}
ci_left <- data.table()
for(RHS in c("none", "demographics", "all")){
  for(LHS in events){
    ols <- lm(formula = reformulate(termlabels = get(RHS), 
                                    response = LHS),
              data = subset4,
              subset = (surprise == FALSE))
    for(communication in c("interval", "both")){
      tmp <- coefci(x = ols,
                    parm = paste0("communication", communication, ":treatedTRUE"),
                    vcov = vcovCL(x = ols, 
                                  cluster = subset4[surprise == FALSE,
                                                 participant.label], 
                                  type = "HC1"),
                    level = 0.95) %>% 
        data.table(model = RHS, outcome = paste0(LHS, " (", communication, ")"))
      tmp[, center := (`2.5 %` + `97.5 %`)/2]
      
      ci_left <- rbind(ci_left, tmp)
    }
  }
}
```

```{r}
ci_left %>% head(n = 7) %>% kable()
```

```{r viz_left_49}
left <- ggplot(data = ci_left,
       mapping = aes(y = outcome)) +
  geom_pointrange(mapping = aes(x = center,
                                y = outcome,
                                xmin = `2.5 %`,
                                xmax = `97.5 %`,
                                shape = factor(model)),
                  data = ci_left,
                  position = position_dodge(width = 0.4),
                  fatten=5,
                  alpha=.8) +
  scale_y_discrete(limits=c("E13 (interval)","E13 (both)","E23 (interval)","E23 (both)","E12 (interval)","E12 (both)","E3 (interval)","E3 (both)","E2 (interval)","E2 (both)","E1 (interval)","E1 (both)"))+
  geom_vline(xintercept = 0, 
             color = "red", 
             alpha = 0.66, 
             show.legend = FALSE) +
  theme_bw() +
  labs(y = "Ambiguity Index", 
       x = "Estimate",
       shape="Control variables")
```

## Right Panel

```{r data_right_498}
ci_right <- data.table()
for(RHS in c("none", "demographics", "all")){
  for(LHS in events){
    ols <- lm(formula = reformulate(termlabels = get(RHS), 
                                    response = LHS),
              data = subset4,
              subset = (surprise == TRUE))
    for(communication in c("interval", "both")){
      tmp <- coefci(x = ols,
                    parm = paste0("communication", communication, ":treatedTRUE"),
                    vcov = vcovCL(x = ols, 
                                  cluster = subset4[surprise == TRUE,
                                                 participant.label], 
                                  type = "HC1"),
                    level = 0.95) %>% 
        data.table(model = RHS, outcome = paste0(LHS, " (", communication, ")"))
      tmp[, center := (`2.5 %` + `97.5 %`)/2]
      
      ci_right <- rbind(ci_right, tmp)
    }
  }
}
```

```{r89}
ci_right %>% head(n = 7) %>% kable()
```

```{r viz_right_49}
right <- ggplot(data = ci_right,
       mapping = aes(y = outcome)) +
  geom_pointrange(mapping = aes(x = center,
                                y = outcome,
                                xmin = `2.5 %`,
                                xmax = `97.5 %`,
                                shape = factor(model)),
                  data = ci_right,
                  position = position_dodge(width = 0.4),
                  fatten=5,
                  alpha=.8) +
  geom_vline(xintercept = 0, 
             color = "red", 
             alpha = 0.66, 
             show.legend = FALSE) +
  theme_bw() +
  labs(y = "Ambiguity Index", 
       x = "Estimate",
       shape="Control variables") +
  scale_y_discrete(position = "right",limits=c("E13 (interval)","E13 (both)","E23 (interval)","E23 (both)","E12 (interval)","E12 (both)","E3 (interval)","E3 (both)","E2 (interval)","E2 (both)","E1 (interval)","E1 (both)"))
```

## Assemble Top, Left and Right Panels

```{r fig_49}
#| label: fig-od8
#| fig-cap: 'Treatment effects of regression equation (1) with matching probabilities for all events as depen- dent variables. Estimators with 95% confidence intervals. The underlying standard errors (“HC1”) are clustered at the individual level and estimated with the R package sandwich (Zeileis, 2004; Zeileis et al., 2020).'

(top / (left | right) & theme(legend.position = "bottom")) + plot_layout(guides = "collect")
```



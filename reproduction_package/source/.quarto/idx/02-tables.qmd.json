{"title":"Tables","markdown":{"headingText":"Tables","containsRefs":false,"markdown":"\nThis document explains how to reproduce the tables presented in the paper.\n\n# Install Packages\n\nWe install the following packages using the `groundhog` package manager to increase computational reproducibility.\n\n```{r install_packages}\n#| output: false\n\noptions(repos = c(CRAN = \"https://cran.r-project.org\")) \n\n\nif (!requireNamespace(\"groundhog\", quietly = TRUE)) {\n    install.packages(\"groundhog\")\n}\n\npkgs <- c(\"magrittr\", \"data.table\", \"stringr\", \"lubridate\", \"knitr\", \n          \"sandwich\", \"lmtest\",\n          \"sjPlot\", \"stargazer\", \"gt\")\n\ngroundhog::groundhog.library(pkg = pkgs,\n                             date = \"2024-08-01\")\n\nrm(pkgs)\n```\n\n## Read Data\n\n```{r read_data}\n# data <- data.table::fread(file = \"../data/processed/full.csv\")\ndata <- readRDS(file=\"../data/processed/full.Rda\")\n```\n\n\n## Table 2\n\nThis table was created in a manual process, the corresponding summary statistics can be queried using the following code, where `surprise == FALSE` selects the `confirmation` treatment arm:\n\n```{r}\ndata[communication == \"point\" & surprise == FALSE,      # choose condition\n     .(mean = round(mean(b, na.rm = TRUE), digits = 2), # choose variable\n       sd = round(sd(b, na.rm = TRUE), digits = 2)),    # choose variable\n     by = stage] %>% \n  kable()\n```\n\nThe number of observations by treatment can be queried using the following code:\n\n```{r}\ndata[, \n     .(N = length(unique(participant.label))), \n     by = c(\"communication\", \"surprise\")][order(surprise, communication)] %>%\n  kable()\n# alternatively:\n# data[stage == 2, \n#      .N, \n#      by = c(\"communication\", \"surprise\")][order(surprise, communication)]\n```\n\n```{r}\n# Melt the data\nlong_df <- melt(data,\n                id.vars = c(\"stage\", \"surprise\", \"communication\"),\n                measure.vars = c(\"b\", \"a\", \"E1\", \"E2\", \"E3\", \"E12\", \"E13\", \"E23\"),\n                variable.name = \"Variable\",\n                value.name = \"Value\")\n\n# Function to calculate mean and sd\ncalculate_stats <- function(x) {\n  c(mean = mean(x, na.rm = TRUE), sd = sd(x, na.rm = TRUE))\n}\n\n# Calculate pooled summary\npooled_summary <- long_df[, as.list(calculate_stats(Value)), by = .(Variable, stage)]\nsetnames(pooled_summary, c(\"mean\", \"sd\"), c(\"mean_pooled\", \"sd_pooled\"))\n\n# Calculate summary by treatment\nsummary_tmp <- long_df[, as.list(calculate_stats(Value)), \n                       by = .(surprise, communication, Variable, stage)]\n\n# Reshape summary_tmp to wide format\nsummary_wide <- dcast(summary_tmp, \n                      Variable + stage ~ surprise + communication, \n                      value.var = c(\"mean\", \"sd\"))\n\n# Merge pooled summary with reshaped summary\nsummary_table_wide <- merge(x = pooled_summary,\n                            y = summary_wide, \n                            by = c(\"Variable\", \"stage\"))\n\n# Function to format mean and sd without line break\nformat_mean_sd <- function(mean, sd) {\n  sprintf(\"%.2f (%.2f)\", mean, sd)\n}\n\n# Apply formatting\ncols_to_format <- names(summary_table_wide)[3:length(names(summary_table_wide))]\nsummary_table_wide[, (cols_to_format) := lapply(.SD, as.numeric), .SDcols = cols_to_format]\nsummary_table_wide[, c(\"Pooled\", \"Confirmation_point\", \"Confirmation_both\", \"Confirmation_interval\", \n                       \"Contradiction_point\", \"Contradiction_both\", \"Contradiction_interval\") := \n                     .(format_mean_sd(mean_pooled, sd_pooled),\n                       format_mean_sd(mean_FALSE_point, sd_FALSE_point),\n                       format_mean_sd(mean_FALSE_both, sd_FALSE_both),\n                       format_mean_sd(mean_FALSE_interval, sd_FALSE_interval),\n                       format_mean_sd(mean_TRUE_point, sd_TRUE_point),\n                       format_mean_sd(mean_TRUE_both, sd_TRUE_both),\n                       format_mean_sd(mean_TRUE_interval, sd_TRUE_interval))]\n\n# Select only the formatted columns\nsummary_table_final <- summary_table_wide[, .(Variable, stage, Pooled, \n                                              Confirmation_point, Confirmation_both, Confirmation_interval,\n                                              Contradiction_point, Contradiction_both, Contradiction_interval)]\n\n# Create gt table\nsummary_table_final %>% \n  gt(groupname_col = \"Variable\") %>% \n  cols_label(\n    stage = \"Stage\",\n    Pooled = \"Pooled\",\n    Confirmation_point = \"Point\",\n    Confirmation_both = \"Point + interval\",\n    Confirmation_interval = \"Interval\",\n    Contradiction_point = \"Point\",\n    Contradiction_both = \"Point + interval\",\n    Contradiction_interval = \"Interval\"\n  ) %>%\n  tab_spanner(\n    label = \"Confirmation\",\n    columns = c(Confirmation_point, Confirmation_both, Confirmation_interval)\n  ) %>%\n  tab_spanner(\n    label = \"Contradiction\",\n    columns = c(Contradiction_point, Contradiction_both, Contradiction_interval)\n  ) %>%\n  cols_align(\n    align = \"left\",\n    columns = c(Variable, stage)\n  ) %>%\n  cols_align(\n    align = \"center\",\n    columns = c(Pooled, Confirmation_point, Confirmation_both, Confirmation_interval,\n                Contradiction_point, Contradiction_both, Contradiction_interval)\n  ) %>%\n  opt_row_striping() %>%\n  tab_options(\n    table.font.size = px(12),\n    data_row.padding = px(4)\n  )\n\n```\n\n\n## Table 3\n\n```{r covariates}\n#| eval: false\n#| include: false\ndemographics <- c(\"age_35_52\",\"age_53_plus\",\"female\", \"high_education\", \"high_income\", \"married\", \"parentship\")\n\nall <- c(demographics, \"high_temperature\",\"high_usage\",\"high_general_risk\",\"high_weather_risk\",\"high_accuracy\",\"high_credibility\")\n\nols_3_1 <- lm(formula = reformulate(c(demographics), response=\"b\"),\n            data = data,\n            subset = (treated == FALSE))\nse_3_1  <- coeftest(ols_3_1, vcov = vcovHC(ols_3_1, type = \"HC1\"))\n\nols_3_2 <- lm(formula = reformulate(c(all), response=\"b\"),\n            data = data,\n            subset = (treated == FALSE))\nse_3_2  <- coeftest(ols_3_2, vcov = vcovHC(ols_3_2, type = \"HC1\"))\n\nols_3_3 <- lm(formula = reformulate(c(demographics), response=\"a\"),\n            data = data,\n            subset = (treated == FALSE))\nse_3_3  <- coeftest(ols_3_3, vcov = vcovHC(ols_3_3, type = \"HC1\"))\n\nols_3_4 <- lm(formula = reformulate(c(all), response=\"a\"),\n            data = data,\n            subset = (treated == FALSE))\nse_3_4  <- coeftest(ols_3_4, vcov = vcovHC(ols_3_4, type = \"HC1\"))\n```\n\n```{r regression_models_table_3}\nols_3_1 <- lm(formula = b ~ age_35_52 + age_53_plus + female + high_education + high_income + \n    married + parentship, \n            data = data, \n            subset = (treated == FALSE))\nse_3_1  <- coeftest(ols_3_1, vcov = vcovHC(ols_3_1, type = \"HC1\"))\n\nols_3_2 <- lm(formula = b ~ age_35_52 + age_53_plus + female + high_education + high_income + \n    married + parentship + high_temperature + high_usage + high_general_risk + \n    high_weather_risk + high_accuracy + high_credibility, \n            data = data, \n            subset = (treated == FALSE))\nse_3_2  <- coeftest(ols_3_2, vcov = vcovHC(ols_3_2, type = \"HC1\"))\n\nols_3_3 <- lm(formula = a ~ age_35_52 + age_53_plus + female + high_education + high_income + \n    married + parentship, \n            data = data, \n            subset = (treated == FALSE))\nse_3_3  <- coeftest(ols_3_3, vcov = vcovHC(ols_3_3, type = \"HC1\"))\n\nols_3_4 <- lm(formula = a ~ age_35_52 + age_53_plus + female + high_education + high_income + \n    married + parentship + high_temperature + high_usage + high_general_risk + \n    high_weather_risk + high_accuracy + high_credibility, \n            data = data, \n            subset = (treated == FALSE))\nse_3_4  <- coeftest(ols_3_4, vcov = vcovHC(ols_3_4, type = \"HC1\"))\n```\n\n```{r regression_output_table_3}\n#| results: asis\n\nse_3 <- list(se_3_1[,2], se_3_2[,2], se_3_3[,2], se_3_4[,2])\np_3  <- list(se_3_1[,4], se_3_2[,4], se_3_3[,4], se_3_4[,4])\n\nstargazer(ols_3_1, ols_3_2, ols_3_3, ols_3_4, \n          align = TRUE, \n          se = se_3, \n          p = p_3,   \n          title = \"Linear regressions: Explanatory analysis of Ambiguity Indices b and a\",\n          covariate.labels = c(\"age(35-52)\",\n                               \"age(53-69)\",\n                               \"gender (female)\",\n                               \"high education\",\n                               \"high income\",\n                               \"family (married or same sex union)\",\n                               \"parentship\",\n                               \"high temperature (median)\",\n                               \"high weather forecast usage (median)\",\n                               \"high general risk attitude (median)\",\n                               \"high weather risk attitude (median)\",\n                               \"high accuracy (median)\",\n                               \"high credibility (median)\",\n                               \"Constant\"), \n          font.size = \"scriptsize\",\n          type = \"html\", \n          df = FALSE,\n          style = \"qje\")\n```\n\n## Table 4\n\n```{r}\nols_4_1 <- lm(formula = b ~ surprise + treated + surprise*treated, \n            data = data)\nse_4_1  <- coeftest(x = ols_4_1, \n                    vcov = vcovCL(ols_4_1,\n                                  cluster = ~data$participant.label,\n                                  type = \"HC1\"))\n\nols_4_2 <- lm(formula = b ~ communication + treated + communication*treated, \n            data = data,\n            subset = (surprise == FALSE))\nse_4_2  <- coeftest(x = ols_4_2, \n                    vcov = vcovCL(ols_4_2,\n                                  cluster = data[surprise == FALSE, participant.label],\n                                  type = \"HC1\"))\n\nols_4_3 <- lm(formula = b ~ communication + treated + communication*treated, \n            data = data,\n            subset = (surprise == TRUE))\nse_4_3  <- coeftest(x = ols_4_3, \n                    vcov = vcovCL(ols_4_3,\n                                  cluster = data[surprise == TRUE, participant.label],\n                                  type = \"HC1\"))\n\nols_4_4 <- lm(formula = b ~ surprise + treated + surprise*treated, \n            data = data,\n            subset = (communication == \"point\"))\nse_4_4  <- coeftest(x = ols_4_4, \n                    vcov = vcovCL(ols_4_4,\n                                  cluster = data[communication == \"point\", participant.label],\n                                  type = \"HC1\"))\n\nols_4_5 <- lm(formula = b ~ surprise + treated + surprise*treated, \n            data = data,\n            subset = (communication == \"interval\"))\nse_4_5  <- coeftest(x = ols_4_5, \n                    vcov = vcovCL(ols_4_5,\n                                  cluster = data[communication == \"interval\", participant.label],\n                                  type = \"HC1\"))\n\nols_4_6 <- lm(formula = b ~ surprise + treated + surprise*treated, \n            data = data,\n            subset = (communication == \"both\"))\nse_4_6  <- coeftest(x = ols_4_6, \n                    vcov = vcovCL(ols_4_6,\n                                  cluster = data[communication == \"both\", participant.label],\n                                  type = \"HC1\"))\n```\n\n```{r regression_output_table_4}\n#| results: asis\n\nse_4 <- list(se_4_1[,2], se_4_2[,2], se_4_3[,2], se_4_4[,2], se_4_5[,2], se_4_6[,2])\np_4  <- list(se_4_1[,4], se_4_2[,4], se_4_3[,4], se_4_4[,4], se_4_5[,4], se_4_6[,4])\n\nstargazer(ols_4_1, ols_4_2, ols_4_3, ols_4_4, ols_4_5, ols_4_6, \n          align = TRUE, \n          se = se_4, \n          p = p_4,   \n          title = \"Linear regressions: Treatment effects on ambiguity index b\",\n          dep.var.caption = \"Dependent variable: b\",\n          dep.var.labels = \" \",\n          model.names = FALSE,\n          column.labels = c(\"full\", \"confirmation\", \"contradiction\", \"point\", \"interval\", \"both\"),\n          covariate.labels = c(\"contradiction\", \"both\", \"interval\", \"stage 2\", \"contradiction x stage 2\", \"interval x stage 2\", \"both x stage 2\", \"Constant\"),\n          font.size = \"scriptsize\",\n          type = \"html\", \n          df = FALSE)\n\n```\n\n## Table 5\n\n```{r}\nols_5_1 <- lm(formula = a ~ surprise + treated + surprise*treated,\n              data = data)\nse_5_1  <- coeftest(x = ols_5_1, \n                    vcov = vcovCL(ols_5_1,\n                                  cluster = ~data$participant.label,\n                                  type = \"HC1\"))\n\nols_5_2 <- lm(formula = a ~ communication + treated + communication*treated,\n              data = data,\n              subset = (surprise == FALSE))\nse_5_2  <- coeftest(x = ols_5_2, \n                    vcov = vcovCL(ols_5_2,\n                                  cluster = data[surprise == FALSE, participant.label],\n                                  type = \"HC1\"))\n\nols_5_3 <- lm(formula = a ~ communication + treated + communication*treated,\n              data = data,\n              subset = (surprise == TRUE))\nse_5_3  <- coeftest(x = ols_5_3, \n                    vcov = vcovCL(ols_5_3,\n                                  cluster = data[surprise == TRUE, participant.label],\n                                  type = \"HC1\"))\n\nols_5_4 <- lm(formula = a ~ surprise + treated + surprise*treated, \n              data = data,\n              subset = (communication == \"point\"))\nse_5_4  <- coeftest(x = ols_5_4, \n                    vcov = vcovCL(ols_5_4,\n                                  cluster = data[communication == \"point\", participant.label],\n                                  type = \"HC1\"))\n\nols_5_5 <- lm(formula = a ~ surprise + treated + surprise*treated, \n              data = data,\n              subset = (communication == \"interval\"))\nse_5_5  <- coeftest(x = ols_5_5, \n                    vcov = vcovCL(ols_5_5,\n                                  cluster = data[communication == \"interval\", participant.label],\n                                  type = \"HC1\"))\n\nols_5_6 <- lm(formula = a ~ surprise + treated + surprise*treated, \n              data = data,\n              subset = (communication == \"both\"))\nse_5_6  <- coeftest(x = ols_5_6, \n                    vcov = vcovCL(ols_5_6,\n                                  cluster = data[communication == \"both\", participant.label],\n                                  type = \"HC1\"))\n```\n\n```{r regression_output_table_5}\n#| results: asis\n\nse_5 <- list(se_5_1[,2], se_5_2[,2], se_5_3[,2], se_5_4[,2], se_5_5[,2], se_5_6[,2])\np_5  <- list(se_5_1[,4], se_5_2[,4], se_5_3[,4], se_5_4[,4], se_5_5[,4], se_5_6[,4])\n\nstargazer(ols_5_1, ols_5_2, ols_5_3, ols_5_4, ols_5_5, ols_5_6, \n          align = TRUE, \n          se = se_5, \n          p = p_5,   \n          title = \"Linear regressions: Treatment effects on ambiguity index a\",\n          dep.var.caption = \"Dependent variable: a\",\n          dep.var.labels = \" \",\n          model.names = FALSE,\n          column.labels = c(\"full\", \"confirmation\", \"contradiction\", \"point\", \"interval\", \"both\"),\n          covariate.labels = c(\"contradiction\", \"both\", \"interval\", \"stage 2\", \"contradiction x stage 2\", \"interval x stage 2\", \"both x stage 2\", \"Constant\"),\n          font.size = \"scriptsize\",\n          type = \"html\", \n          df = FALSE)\n\n```\n\n## Table 6\n\n```{r}\nols_6_1 <- lm(formula = ed ~ surprise, \n            data = data,\n            subset = (stage == 2))\nse_6_1  <- coeftest(ols_6_1, vcov = vcovHC(ols_6_1, type = \"HC1\"))\n\nols_6_2 <- lm(formula = ed ~ communication, \n            data = data,\n            subset = (stage == 2 & surprise == FALSE))\nse_6_2  <- coeftest(ols_6_2, vcov = vcovHC(ols_6_2, type = \"HC1\"))\n\nols_6_3 <- lm(formula = ed ~ communication, \n            data = data,\n            subset = (stage == 2 & surprise == TRUE))\nse_6_3  <- coeftest(ols_6_3, vcov = vcovHC(ols_6_3, type = \"HC1\"))\n\nols_6_4 <- lm(formula = ed ~ surprise, \n            data = data,\n            subset = (stage == 2 & communication == \"point\"))\nse_6_4  <- coeftest(ols_6_4, vcov = vcovHC(ols_6_4, type = \"HC1\"))\n\nols_6_5 <- lm(formula = ed ~ surprise, \n            data = data,\n            subset = (stage == 2 & communication == \"interval\"))\nse_6_5  <- coeftest(ols_6_5, vcov = vcovHC(ols_6_5, type = \"HC1\"))\n\nols_6_6 <- lm(formula = ed ~ surprise, \n            data = data,\n            subset = (stage == 2 & communication == \"both\"))\nse_6_6  <- coeftest(ols_6_6, vcov = vcovHC(ols_6_6, type = \"HC1\"))\n```\n\n```{r regression_output_table_6}\n#| results: asis\n\nse_6 <- list(se_6_1[,2], se_6_2[,2], se_6_3[,2], se_6_4[,2], se_6_5[,2], se_6_6[,2])\np_6  <- list(se_6_1[,4], se_6_2[,4], se_6_3[,4], se_6_4[,4], se_6_5[,4], se_6_6[,4])\n\nstargazer(ols_6_1, ols_6_2, ols_6_3, ols_6_4, ols_6_5, ols_6_6, \n          align = TRUE, \n          se = se_6,\n          p = p_6,   \n          title = \"Linear regressions: Treatment effects on Euclidian distance between vector of matching probabilities in stage 1 vs. stage 2\",\n          dep.var.caption = \"Dependent variable: Euclidian distance stage 2 vs. stage 1\",\n          dep.var.labels = \" \",\n          model.names = FALSE,\n          column.labels = c(\"full\", \"confirmation\", \"contradiction\", \"point\", \"interval\", \"both\"),\n          covariate.labels = c(\"contradiction\", \"both\", \"interval\", \"Constant\"),\n          font.size = \"scriptsize\",\n          type = \"html\", \n          df = FALSE)\n\n```\n\n<!--\n# Appendix B\n\n```{r wrapper_function}\n#| eval: false\nevent_regressions <- function(event = \"E1\"){\n  ols_1 <- lm(formula = reformulate(c(\"surprise\", \"treated\", \"surprise*treated\"), response = event),\n              data = data)\n  se_1  <- coeftest(x = ols_1, \n                    vcov = vcovCL(ols_1,\n                                  cluster = ~data$participant.label,\n                                  type = \"HC1\"))\n  \n  ols_2 <- lm(formula = reformulate(c(\"communication\", \"treated\", \"communication*treated\"), response = event), \n              data = data,\n              subset = (surprise == FALSE))\n  se_2  <- coeftest(x = ols_2, \n                    vcov = vcovCL(ols_2,\n                                  cluster = data[surprise == FALSE, participant.label],\n                                  type = \"HC1\"))\n  \n  ols_3 <- lm(formula = reformulate(c(\"communication\", \"treated\", \"communication*treated\"), response = event), \n              data = data,\n              subset = (surprise == TRUE))\n  se_3  <- coeftest(x = ols_3, \n                    vcov = vcovCL(ols_3,\n                                  cluster = data[surprise == TRUE, participant.label],\n                                  type = \"HC1\"))\n  \n  ols_4 <- lm(formula = reformulate(c(\"surprise\", \"treated\", \"surprise*treated\"), response = event), \n              data = data,\n              subset = (communication == \"point\"))\n  se_4  <- coeftest(x = ols_4, \n                    vcov = vcovCL(ols_4,\n                                  cluster = data[communication == \"point\", participant.label],\n                                  type = \"HC1\"))\n  \n  ols_5 <- lm(formula = reformulate(c(\"surprise\", \"treated\", \"surprise*treated\"), response = event), \n              data = data,\n              subset = (communication == \"interval\"))\n  se_5  <- coeftest(x = ols_5, \n                    vcov = vcovCL(ols_5,\n                                  cluster = data[communication == \"interval\", participant.label],\n                                  type = \"HC1\"))\n  \n  ols_6 <- lm(formula = reformulate(c(\"surprise\", \"treated\", \"surprise*treated\"), response = event), \n              data = data,\n              subset = (communication == \"both\"))\n  se_6  <- coeftest(x = ols_6, \n                    vcov = vcovCL(ols_6,\n                                  cluster = data[communication == \"both\", participant.label],\n                                  type = \"HC1\"))\n\n\n  \n  se <- list(se_1[,2], se_2[,2], se_3[,2], se_4[,2], se_5[,2], se_6[,2])\n  p  <- list(se_1[,4], se_2[,4], se_3[,4], se_4[,4], se_5[,4], se_6[,4])\n  \n  stargazer(ols_1, ols_2, ols_3, ols_4, ols_5, ols_6, \n            align = TRUE, \n            se = se, \n            p = p,   \n            title = paste0(\"Linear regressions: Treatment effects on \", event),\n            font.size = \"scriptsize\",\n            type = \"html\", \n            df = FALSE)\n}\n```\n\n\n## E1\n\n```{r E1}\n#| eval: false\n#| results: asis\nevent_regressions(event = \"E1\")\n```\n\n\n## E2\n\n```{r E2}\n#| eval: false\n#| results: asis\nevent_regressions(event = \"E2\")\n```\n\n\n## E3\n\n```{r E3}\n#| eval: false\n#| results: asis\nevent_regressions(event = \"E3\")\n```\n\n\n## E12\n\n```{r E12}\n#| eval: false\n#| results: asis\nevent_regressions(event = \"E12\")\n```\n\n\n## E13\n\n```{r E13}\n#| eval: false\n#| results: asis\nevent_regressions(event = \"E13\")\n```\n\n\n## E23\n\n```{r E23}\n#| eval: false\n#| results: asis\nevent_regressions(event = \"E23\")\n```\n\n-->"},"formats":{"html":{"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":false,"echo":true,"output":true,"warning":false,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"engine":"knitr"},"render":{"keep-tex":false,"keep-yaml":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[]},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","embed-resources":true,"output-file":"02-tables.html"},"language":{},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.1.132","bibliography":["references.bib"],"theme":"cosmo"},"extensions":{"book":{"multiFile":true}}}}}